<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>IMPACT+</title>
  <script src="https://unpkg.com/vue@next"></script>
  <link href="https://unpkg.com/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="text-white bg-black p-16">
  <div id="app">
    <image-container></image-container>

    <div id="main-container">
      <logo-component></logo-component>

      <image-wrapper>
        <image-component v-for="image in images" :src="image"></image-component>
      </image-wrapper>

      <specs-wrapper>
        <row-component v-for="spec in specs" :label="spec.label" :description="spec.description">
          {{ spec.value }}
        </row-component>
      </specs-wrapper>
    </div>
  </div>

  <script>
    const { createApp, ref } = Vue

    const localeGids = {
      pl: '288038175',
      en: '35753055'
    }

    const imagesGid = 1866743414

    const locale = (navigator.language || navigator.userLanguage).split('-')[0]

    async function loadTSV(gid) {
      const spreadsheetId = '2PACX-1vRq2HxY-FYmQrcjCsB015FGey51cT3fMV28ED2qjnTzPAjerJitb3YqzzZsIVxzj1G26B1KvfEt5r6D'
      const url = `https://docs.google.com/spreadsheets/d/e/${spreadsheetId}/pub?output=tsv&gid=${gid}`
      const response = await fetch(url)
      const csvData = await response.text()

      const rows = csvData.split('\n')

      const headers = rows[0].split('\t').map(header => header.trim())

      rows.shift()

      const parsedData = rows.map(row => {
        const values = row.split('\t').map(value => value.trim())
        return headers.reduce((obj, header, index) => {
          obj[header] = values[index]
          return obj
        }, {})
      })

      return parsedData
    }

    const toggleFullImage = () => {
      document.getElementById('main-container').classList.toggle('hidden')
      document.getElementById('image-container').classList.toggle('hidden')
      document.getElementById('full-image').src = event.target.src
    }

    const ImageWrapper = {
      template: `<div class="grid grid-cols-3 gap-4 mb-12"><slot></slot></div>`
    }

    const ImageComponent = {
      props: ['src'],
      template: `<div><img :src="src" class="rounded-lg" @click="handleClick"/></div>`,
      methods: {
        handleClick() {
          toggleFullImage()
        }
      }
    }

    const ImageContainer = {
      template: `
        <div id="image-container" @click="handleClick" class="fixed inset-0 z-100 hidden">
          <img id="full-image" class="w-full h-full object-contain" />
        </div>
      `,
      methods: {
        handleClick() {
          toggleFullImage()
        }
      }
    }

    const LogoComponent = {
      template: `
        <div class="w-full bg-blue-500 p-8 mb-4 rounded-lg">
          <h1 class="text-4xl text-white">IMPACT+</h1>
        </div>
      `
    }

    const RowComponent = {
      props: ['label', 'description'],
      template: `
        <div>
          <strong class="text-2xl text-blue-500 float-right uppercase">{{ label }}</strong>
        </div>
        <div class="border-l-4 pl-2">
          <p class="text-2xl font-thin"><slot></slot></p>
          <em class="text-gray-400">{{ description }}</em>
        </div>
      `
    }

    const SpecsWrapper = {
      template: `<div class="grid grid-cols-2 gap-4"><slot></slot></div>`
    }

    const app = createApp({
      setup() {
        const specs = ref([])
        const images = ref([])

        loadTSV(localeGids[locale]).then(data => {
          specs.value = data
        })

        loadTSV(imagesGid).then(data => {
          images.value = data.map(image => image.url)
        })

        return {
          specs, images
        }
      }
    })

    app.component('logo-component', LogoComponent)
    app.component('row-component', RowComponent)
    app.component('specs-wrapper', SpecsWrapper)
    app.component('image-wrapper', ImageWrapper)
    app.component('image-component', ImageComponent)
    app.component('image-container', ImageContainer)

    app.mount('#app')
  </script>

  <style>
    #image-contaner {
      width: 100%;
      height: 100%;
    }
  </style>
</body>

</html>