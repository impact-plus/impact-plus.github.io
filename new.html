<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Vue 3 Single File HTML</title>
  <script src="https://unpkg.com/vue@next"></script>
  <link href="https://unpkg.com/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
</head>

<body>
  <div id="app">
    <logo-component></logo-component>
    <pre>{{ csv }}</pre>

    <specs-wrapper>
      <row-component v-for="spec in csv[locale]" :label="spec.label" :description="spec.description">
        {{ spec.value }}
      </row-component>
    </specs-wrapper>
  </div>

  <script>
    const { createApp, ref } = Vue

    const getLocale = () => {
      if (navigator.language == 'pl') {
        return 'pl'
      } else {
        return 'en'
      }
    }

    async function loadCSV() {
      const response = await fetch('http://127.0.0.1:8080/test.csv')
      const csvData = await response.text()

      debugger

      const rows = csvData.split('\n')

      const headers = rows[0].replace(/;/g, '').split(',').map(header => header.trim())

      rows.shift()

      const parsedData = rows.map(row => {
        const values = row.replace(/;/g, '').split(',').map(value => value.trim())
        return headers.reduce((obj, header, index) => {
          obj[header] = values[index]
          return obj
        }, {})
      })

      return parsedData
    }

    const LogoComponent = {
      template: `
        <div class="w-full bg-blue-500 p-8 mb-4 rounded-lg">
          <h1 class="text-4xl text-white">IMPACT+</h1>
        </div>
      `
    }

    const RowComponent = {
      props: ['label', 'description'],
      template: `
        <div>
          <strong class="text-2xl text-blue-500 float-right uppercase">{{ label }}</strong>
        </div>
        <div class="border-l-4 pl-2">
          <p class="text-2xl font-thin"><slot></slot></p>
          <em class="text-gray-400">{{ description }}</em>
        </div>
      `
    }

    const SpecsWrapper = {
      template: `<div class="grid grid-cols-2 gap-4"><slot></slot></div>`
    }

    const app = createApp({
      setup() {
        const csv = ref([])
        const locale = ref(getLocale())

        loadCSV().then(data => {
          csv.value = data
        })

        return {
          csv
        }
      }
    })

    app.component('logo-component', LogoComponent)

    app.mount('#app')
  </script>
</body>

</html>